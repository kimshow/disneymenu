# Phase 8: ãƒãƒƒãƒ—æ©Ÿèƒ½ - å®Ÿè£…è¨ˆç”»æ›¸

**æƒ³å®šæœŸé–“**: 3é€±é–“ï¼ˆå®Ÿåƒ21æ—¥ï¼‰  
**é–‹å§‹äºˆå®š**: Phase 7å®Œäº†å¾Œ  
**æ‹…å½“**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ + åœ°å›³APIçµ±åˆ  
**ç›®çš„**: ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã®ä½ç½®æƒ…å ±æä¾›ã¨ãƒ‘ãƒ¼ã‚¯å†…ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“å‘ä¸Š

---

## ğŸ“Œ ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

### ç›®æ¨™
- ãƒ‘ãƒ¼ã‚¯å†…ã®ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ä½ç½®ã‚’åœ°å›³ä¸Šã§è¦–è¦šçš„ã«è¡¨ç¤º
- ç¾åœ¨åœ°ã‹ã‚‰ã®ãƒ«ãƒ¼ãƒˆæ¡ˆå†…æ©Ÿèƒ½
- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ã¨é€£å‹•ã—ãŸã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒãƒ—

### ä¸»è¦æ©Ÿèƒ½ï¼ˆå„ªå…ˆåº¦é †ï¼‰

1. **Google Maps APIçµ±åˆ** ğŸ”¥ï¼ˆ7æ—¥é–“ï¼‰
   - APIè¨­å®šã¨ãƒãƒƒãƒ—è¡¨ç¤º
   - ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ãƒãƒ¼ã‚«ãƒ¼é…ç½®
   - ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨

2. **ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒãƒ—** ğŸ”¥ï¼ˆ7æ—¥é–“ï¼‰
   - ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒªãƒƒã‚¯ã§æƒ…å ±è¡¨ç¤º
   - ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é€£å‹•
   - ã‚¨ãƒªã‚¢åˆ¥çµã‚Šè¾¼ã¿

3. **ãƒ«ãƒ¼ãƒˆæ¡ˆå†…æ©Ÿèƒ½** ğŸŸ¡ï¼ˆ5æ—¥é–“ï¼‰
   - ç¾åœ¨åœ°å–å¾—
   - ãƒ«ãƒ¼ãƒˆè¡¨ç¤º
   - æ‰€è¦æ™‚é–“è¡¨ç¤º

4. **ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒãƒƒã‚°** ğŸŸ¢ï¼ˆ2æ—¥é–“ï¼‰
   - E2Eãƒ†ã‚¹ãƒˆè¿½åŠ ï¼ˆ8ä»¶ï¼‰
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

---

## ğŸ¯ ç¾çŠ¶åˆ†æ

### âœ… Phase 7å®Œäº†æ™‚ç‚¹ã§ã®å®Ÿè£…çŠ¶æ³

#### ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
- âœ… Restaurantå‹ï¼ˆåŸºæœ¬æƒ…å ±ï¼‰
- âš ï¸ ä½ç½®æƒ…å ±ï¼ˆç·¯åº¦çµŒåº¦ï¼‰ãŒä¸€éƒ¨ã®ã¿ â†’ Phase 8ã§å…¨ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³åˆ†è¿½åŠ 
- âŒ ã‚¨ãƒªã‚¢å¢ƒç•Œãƒ‡ãƒ¼ã‚¿ãªã— â†’ Phase 8ã§ä½œæˆ

#### æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- âœ… RestaurantDetail.tsx
- âœ… Restaurants.tsxï¼ˆä¸€è¦§ãƒšãƒ¼ã‚¸ï¼‰
- âŒ ãƒãƒƒãƒ—ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãªã—

#### API
- âœ… `/api/restaurants`
- âŒ Google Maps APIæœªçµ±åˆ

---

## ğŸ› ï¸ æŠ€è¡“è¨­è¨ˆ

### Google Maps API

#### APIã‚­ãƒ¼ã®å–å¾—ã¨è¨­å®š

1. **Google Cloud Console**ã§æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
2. **Maps JavaScript API**ã‚’æœ‰åŠ¹åŒ–
3. **Geocoding API**ã‚’æœ‰åŠ¹åŒ–ï¼ˆä½æ‰€â†’åº§æ¨™å¤‰æ›ç”¨ï¼‰
4. APIã‚­ãƒ¼ã‚’å–å¾—ã—ã€ä»¥ä¸‹ã®åˆ¶é™ã‚’è¨­å®šï¼š
   - HTTPãƒªãƒ•ã‚¡ãƒ©ãƒ¼åˆ¶é™: `https://disneymenu.vercel.app/*`
   - APIåˆ¶é™: Maps JavaScript API, Geocoding API ã®ã¿

5. Vercelã®ç’°å¢ƒå¤‰æ•°ã«è¨­å®šï¼š
```bash
VITE_GOOGLE_MAPS_API_KEY=AIzaSy...
```

#### æ–™é‡‘ä½“ç³»ï¼ˆ2026å¹´1æœˆæ™‚ç‚¹ï¼‰

| API | ç„¡æ–™æ  | è¶…éæ–™é‡‘ |
|-----|--------|---------|
| Maps JavaScript API | 28,000å›/æœˆ | $7/1000å› |
| Geocoding API | 40,000å›/æœˆ | $5/1000å› |

**æƒ³å®šã‚³ã‚¹ãƒˆ**: æœˆé–“1,000ãƒ¦ãƒ¼ã‚¶ãƒ¼ Ã— å¹³å‡3ãƒãƒƒãƒ—è¡¨ç¤º = 3,000å› â†’ **ç„¡æ–™æ å†…**

### æ–°è¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

#### Google Maps ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ¯”è¼ƒ

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ã‚µã‚¤ã‚ºï¼ˆgzipï¼‰ | ç‰¹å¾´ | æ¡ç”¨åˆ¤æ–­ |
|-----------|---------------|------|---------|
| @react-google-maps/api | 45KB | å…¬å¼ã€ãƒ•ãƒƒã‚¯å¯¾å¿œ | âœ… æ¡ç”¨ |
| google-map-react | 35KB | è»½é‡ã€å¤ã„ | âŒ æ›´æ–°åœæ­¢ |
| @vis.gl/react-google-maps | 50KB | æ–°ã—ã„ã€é«˜æ©Ÿèƒ½ | âŒ ãƒ™ãƒ¼ã‚¿ç‰ˆ |

**åˆ¤æ–­**: @react-google-maps/api v2.19.0ã‚’æ¡ç”¨ï¼ˆæœ€ã‚‚å®Ÿç¸¾è±Šå¯Œï¼‰

#### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install @react-google-maps/api@2.19.3
npm install @googlemaps/markerclusterer@2.5.3  # ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°
```

### ãƒ‡ãƒ¼ã‚¿æ‹¡å¼µ

#### Restaurantå‹ã®æ‹¡å¼µ
```typescript
interface Restaurant {
  // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  id: string;
  name: string;
  // ...

  // Phase 8ã§è¿½åŠ 
  location: {
    lat: number;
    lng: number;
  };
  address: string;           // ä½æ‰€ï¼ˆæ—¥æœ¬èªï¼‰
  area: string;              // ã‚¨ãƒªã‚¢åï¼ˆä¾‹: "ãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒã‚¶ãƒ¼ãƒ«"ï¼‰
  floor?: number;            // éšæ•°
  nearbyLandmarks: string[]; // è¿‘ãã®ç›®å°
}
```

#### ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ä½ç½®ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™

`data/restaurant_locations.json`:
```json
[
  {
    "restaurantId": "rest_001",
    "name": "ã‚¯ãƒªã‚¹ã‚¿ãƒ«ãƒ‘ãƒ¬ã‚¹ãƒ»ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³",
    "location": {
      "lat": 35.6329,
      "lng": 139.8804
    },
    "address": "åƒè‘‰çœŒæµ¦å®‰å¸‚èˆæµœ1-1 æ±äº¬ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ãƒ©ãƒ³ãƒ‰",
    "area": "ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ãƒ©ãƒ³ãƒ‰",
    "nearbyLandmarks": ["ã‚·ãƒ³ãƒ‡ãƒ¬ãƒ©åŸ", "ã‚¦ã‚¨ã‚¹ã‚¿ãƒ³ãƒªãƒãƒ¼é‰„é“"]
  }
]
```

**ãƒ‡ãƒ¼ã‚¿åé›†æ–¹æ³•**:
1. å…¬å¼ã‚µã‚¤ãƒˆã®åœ°å›³æƒ…å ±ã‚’å‚ç…§
2. Google Mapsã§å„ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã®åº§æ¨™ã‚’æ‰‹å‹•å–å¾—
3. å…¨102ä»¶ã®ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ä½ç½®ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ

---

## ğŸ“… å®Ÿè£…æ‰‹é †

### Phase 8.1: Google Maps APIçµ±åˆï¼ˆ7æ—¥é–“ï¼‰

#### Day 1-2: APIè¨­å®šã¨ãƒ‡ãƒ¼ã‚¿æº–å‚™

**ã‚¿ã‚¹ã‚¯ 8.1.1: Google Cloud Consoleè¨­å®š**

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ: `disney-menu-map`
2. Maps JavaScript APIæœ‰åŠ¹åŒ–
3. Geocoding APIæœ‰åŠ¹åŒ–
4. APIã‚­ãƒ¼ç”Ÿæˆã¨åˆ¶é™è¨­å®š

**ã‚¿ã‚¹ã‚¯ 8.1.2: ç’°å¢ƒå¤‰æ•°è¨­å®š**

`.env.local`:
```env
VITE_GOOGLE_MAPS_API_KEY=AIzaSy...
```

Vercelç’°å¢ƒå¤‰æ•°:
```bash
vercel env add VITE_GOOGLE_MAPS_API_KEY production
```

**ã‚¿ã‚¹ã‚¯ 8.1.3: ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ä½ç½®ãƒ‡ãƒ¼ã‚¿ä½œæˆ**

```python
# scripts/add_restaurant_locations.py
import json

# ä¸»è¦ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³20ä»¶ã®åº§æ¨™ã‚’æ‰‹å‹•ã§è¿½åŠ 
locations = [
    {
        "restaurantId": "rest_001",
        "location": {"lat": 35.6329, "lng": 139.8804},
        "area": "ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ãƒ©ãƒ³ãƒ‰"
    },
    # ... æ®‹ã‚Š19ä»¶
]

with open('data/restaurant_locations.json', 'w', encoding='utf-8') as f:
    json.dump(locations, f, ensure_ascii=False, indent=2)
```

#### Day 3-4: åŸºæœ¬ãƒãƒƒãƒ—è¡¨ç¤º

**ã‚¿ã‚¹ã‚¯ 8.1.4: @react-google-maps/apiã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**

```bash
npm install @react-google-maps/api@2.19.3
```

**ã‚¿ã‚¹ã‚¯ 8.1.5: MapContainer.tsxã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ**

```typescript
import { GoogleMap, LoadScript, Marker } from '@react-google-maps/api';
import { useState } from 'react';

const mapContainerStyle = {
  width: '100%',
  height: '600px',
};

const center = {
  lat: 35.6329, // æ±äº¬ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ãƒ©ãƒ³ãƒ‰ã®ä¸­å¿ƒ
  lng: 139.8804,
};

export const MapContainer: React.FC = () => {
  const [map, setMap] = useState<google.maps.Map | null>(null);

  const onLoad = (map: google.maps.Map) => {
    setMap(map);
  };

  return (
    <LoadScript googleMapsApiKey={import.meta.env.VITE_GOOGLE_MAPS_API_KEY}>
      <GoogleMap
        mapContainerStyle={mapContainerStyle}
        center={center}
        zoom={16}
        onLoad={onLoad}
        options={{
          disableDefaultUI: false,
          zoomControl: true,
          streetViewControl: false,
          mapTypeControl: false,
        }}
      />
    </LoadScript>
  );
};
```

#### Day 5-6: ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ãƒãƒ¼ã‚«ãƒ¼é…ç½®

**ã‚¿ã‚¹ã‚¯ 8.1.6: useRestaurantLocations Hookä½œæˆ**

```typescript
import { useQuery } from '@tanstack/react-query';
import { api } from '../services/api';

export const useRestaurantLocations = () => {
  return useQuery({
    queryKey: ['restaurant-locations'],
    queryFn: async () => {
      const response = await api.get('/api/restaurants/locations');
      return response.data.data;
    },
    staleTime: 1000 * 60 * 60 * 24, // 24æ™‚é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  });
};
```

**ã‚¿ã‚¹ã‚¯ 8.1.7: RestaurantMarkers.tsxã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**

```typescript
import { Marker, InfoWindow } from '@react-google-maps/api';
import { useState } from 'react';
import { Restaurant } from '../../types';

interface RestaurantMarkersProps {
  restaurants: Restaurant[];
  onRestaurantClick: (restaurant: Restaurant) => void;
}

export const RestaurantMarkers: React.FC<RestaurantMarkersProps> = ({
  restaurants,
  onRestaurantClick,
}) => {
  const [selectedRestaurant, setSelectedRestaurant] = useState<Restaurant | null>(null);

  return (
    <>
      {restaurants.map((restaurant) => (
        <Marker
          key={restaurant.id}
          position={restaurant.location}
          onClick={() => setSelectedRestaurant(restaurant)}
          icon={{
            url: '/icons/restaurant-marker.png',
            scaledSize: new google.maps.Size(40, 40),
          }}
        />
      ))}

      {selectedRestaurant && (
        <InfoWindow
          position={selectedRestaurant.location}
          onCloseClick={() => setSelectedRestaurant(null)}
        >
          <div style={{ minWidth: 200 }}>
            <h3>{selectedRestaurant.name}</h3>
            <p>{selectedRestaurant.area}</p>
            <Button
              size="small"
              onClick={() => onRestaurantClick(selectedRestaurant)}
            >
              è©³ç´°ã‚’è¦‹ã‚‹
            </Button>
          </div>
        </InfoWindow>
      ))}
    </>
  );
};
```

#### Day 7: ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨

**ã‚¿ã‚¹ã‚¯ 8.1.8: ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼é¢¨ãƒãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒ«**

```typescript
const mapStyles = [
  {
    featureType: 'poi',
    elementType: 'labels',
    stylers: [{ visibility: 'off' }], // ä¸è¦ãªPOIéè¡¨ç¤º
  },
  {
    featureType: 'water',
    elementType: 'geometry',
    stylers: [{ color: '#a2daf2' }], // æ°´è‰²ã‚’æ˜ã‚‹ã
  },
  {
    featureType: 'landscape',
    elementType: 'geometry',
    stylers: [{ color: '#f5f5dc' }], // ãƒ™ãƒ¼ã‚¸ãƒ¥ç³»
  },
];

// MapContainerã«é©ç”¨
<GoogleMap
  options={{
    styles: mapStyles,
    // ...
  }}
/>
```

---

### Phase 8.2: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒãƒ—ï¼ˆ7æ—¥é–“ï¼‰

#### Day 8-9: ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒªãƒƒã‚¯æƒ…å ±è¡¨ç¤º

**ã‚¿ã‚¹ã‚¯ 8.2.1: RestaurantInfoCard.tsxã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**

```typescript
import { Card, CardContent, CardMedia, Typography, Button, Chip } from '@mui/material';
import { Link } from 'react-router-dom';

export const RestaurantInfoCard: React.FC<{ restaurant: Restaurant }> = ({ restaurant }) => {
  return (
    <Card sx={{ maxWidth: 400 }}>
      <CardMedia
        component="img"
        height="140"
        image={restaurant.imageUrl || '/placeholder.jpg'}
        alt={restaurant.name}
      />
      <CardContent>
        <Typography variant="h6" gutterBottom>
          {restaurant.name}
        </Typography>
        <Typography variant="body2" color="text.secondary" gutterBottom>
          {restaurant.area} Â· {restaurant.park === 'disneyland' ? 'ãƒ©ãƒ³ãƒ‰' : 'ã‚·ãƒ¼'}
        </Typography>
        <Box sx={{ mb: 1 }}>
          {restaurant.features.slice(0, 3).map((feature) => (
            <Chip key={feature} label={feature} size="small" sx={{ mr: 0.5 }} />
          ))}
        </Box>
        <Typography variant="body2" paragraph>
          {restaurant.description}
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button
            variant="contained"
            size="small"
            component={Link}
            to={`/restaurant/${restaurant.id}`}
          >
            è©³ç´°ã‚’è¦‹ã‚‹
          </Button>
          <Button variant="outlined" size="small">
            ãƒ«ãƒ¼ãƒˆæ¡ˆå†…
          </Button>
        </Box>
      </CardContent>
    </Card>
  );
};
```

**ã‚¿ã‚¹ã‚¯ 8.2.2: ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ«çµ±åˆ**

```typescript
export const MapPage = () => {
  const [selectedRestaurant, setSelectedRestaurant] = useState<Restaurant | null>(null);

  return (
    <Box sx={{ display: 'flex', height: 'calc(100vh - 64px)' }}>
      {/* ãƒãƒƒãƒ—ã‚¨ãƒªã‚¢ */}
      <Box sx={{ flex: 1 }}>
        <MapContainer
          restaurants={restaurants}
          onRestaurantClick={setSelectedRestaurant}
        />
      </Box>

      {/* ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ« */}
      {selectedRestaurant && (
        <Drawer
          anchor="right"
          open={Boolean(selectedRestaurant)}
          onClose={() => setSelectedRestaurant(null)}
          variant="persistent"
        >
          <Box sx={{ width: 400, p: 2 }}>
            <RestaurantInfoCard restaurant={selectedRestaurant} />
          </Box>
        </Drawer>
      )}
    </Box>
  );
};
```

#### Day 10-11: ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é€£å‹•

**ã‚¿ã‚¹ã‚¯ 8.2.3: MapFilterPanel.tsxã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**

```typescript
export const MapFilterPanel: React.FC = () => {
  const [selectedPark, setSelectedPark] = useState<string>('all');
  const [selectedArea, setSelectedArea] = useState<string>('all');

  return (
    <Paper
      sx={{
        position: 'absolute',
        top: 80,
        left: 20,
        zIndex: 1,
        p: 2,
        minWidth: 250,
      }}
    >
      <Typography variant="h6" gutterBottom>
        ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
      </Typography>

      <FormControl fullWidth sx={{ mb: 2 }}>
        <InputLabel>ãƒ‘ãƒ¼ã‚¯</InputLabel>
        <Select
          value={selectedPark}
          onChange={(e) => setSelectedPark(e.target.value)}
        >
          <MenuItem value="all">ã™ã¹ã¦</MenuItem>
          <MenuItem value="disneyland">ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ãƒ©ãƒ³ãƒ‰</MenuItem>
          <MenuItem value="disneysea">ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ã‚·ãƒ¼</MenuItem>
        </Select>
      </FormControl>

      <FormControl fullWidth>
        <InputLabel>ã‚¨ãƒªã‚¢</InputLabel>
        <Select
          value={selectedArea}
          onChange={(e) => setSelectedArea(e.target.value)}
        >
          <MenuItem value="all">ã™ã¹ã¦</MenuItem>
          <MenuItem value="ãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒã‚¶ãƒ¼ãƒ«">ãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒã‚¶ãƒ¼ãƒ«</MenuItem>
          <MenuItem value="ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ãƒ©ãƒ³ãƒ‰">ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ãƒ©ãƒ³ãƒ‰</MenuItem>
          {/* ä»–ã®ã‚¨ãƒªã‚¢ */}
        </Select>
      </FormControl>
    </Paper>
  );
};
```

**ã‚¿ã‚¹ã‚¯ 8.2.4: ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨ãƒ­ã‚¸ãƒƒã‚¯**

```typescript
const filteredRestaurants = useMemo(() => {
  let filtered = restaurants;

  if (selectedPark !== 'all') {
    filtered = filtered.filter((r) => r.park === selectedPark);
  }

  if (selectedArea !== 'all') {
    filtered = filtered.filter((r) => r.area === selectedArea);
  }

  return filtered;
}, [restaurants, selectedPark, selectedArea]);
```

#### Day 12-14: ã‚¨ãƒªã‚¢åˆ¥çµã‚Šè¾¼ã¿ã¨ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°

**ã‚¿ã‚¹ã‚¯ 8.2.5: ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°å®Ÿè£…**

```bash
npm install @googlemaps/markerclusterer@2.5.3
```

```typescript
import { MarkerClusterer } from '@googlemaps/markerclusterer';

export const ClusteredMarkers: React.FC = () => {
  const [clusterer, setClusterer] = useState<MarkerClusterer | null>(null);

  useEffect(() => {
    if (map && markers.length > 0) {
      const newClusterer = new MarkerClusterer({
        map,
        markers,
        algorithm: new SuperClusterAlgorithm({ radius: 100 }),
      });
      setClusterer(newClusterer);
    }
  }, [map, markers]);

  return null;
};
```

**ã‚¿ã‚¹ã‚¯ 8.2.6: ã‚¨ãƒªã‚¢å¢ƒç•Œãƒãƒªã‚´ãƒ³è¡¨ç¤º**

```typescript
import { Polygon } from '@react-google-maps/api';

const adventurelandBounds = [
  { lat: 35.6330, lng: 139.8800 },
  { lat: 35.6335, lng: 139.8810 },
  { lat: 35.6325, lng: 139.8815 },
  { lat: 35.6320, lng: 139.8805 },
];

<Polygon
  paths={adventurelandBounds}
  options={{
    fillColor: '#FFE4B5',
    fillOpacity: 0.2,
    strokeColor: '#FF8C00',
    strokeOpacity: 0.8,
    strokeWeight: 2,
  }}
/>
```

---

### Phase 8.3: ãƒ«ãƒ¼ãƒˆæ¡ˆå†…æ©Ÿèƒ½ï¼ˆ5æ—¥é–“ï¼‰

#### Day 15-16: ç¾åœ¨åœ°å–å¾—

**ã‚¿ã‚¹ã‚¯ 8.3.1: useGeolocation Hookä½œæˆ**

```typescript
import { useState, useEffect } from 'react';

export const useGeolocation = () => {
  const [position, setPosition] = useState<GeolocationPosition | null>(null);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    if (!navigator.geolocation) {
      setError('Geolocation is not supported');
      return;
    }

    navigator.geolocation.getCurrentPosition(
      (pos) => setPosition(pos),
      (err) => setError(err.message)
    );
  }, []);

  return { position, error };
};
```

**ã‚¿ã‚¹ã‚¯ 8.3.2: ç¾åœ¨åœ°ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤º**

```typescript
const { position } = useGeolocation();

{position && (
  <Marker
    position={{
      lat: position.coords.latitude,
      lng: position.coords.longitude,
    }}
    icon={{
      url: '/icons/current-location.png',
      scaledSize: new google.maps.Size(30, 30),
    }}
  />
)}
```

#### Day 17-18: ãƒ«ãƒ¼ãƒˆè¡¨ç¤º

**ã‚¿ã‚¹ã‚¯ 8.3.3: DirectionsServiceçµ±åˆ**

```typescript
import { DirectionsRenderer, DirectionsService } from '@react-google-maps/api';

export const RouteDisplay: React.FC<{
  origin: google.maps.LatLngLiteral;
  destination: google.maps.LatLngLiteral;
}> = ({ origin, destination }) => {
  const [directions, setDirections] = useState<google.maps.DirectionsResult | null>(null);

  const directionsCallback = (result: google.maps.DirectionsResult | null) => {
    if (result && result.routes.length > 0) {
      setDirections(result);
    }
  };

  return (
    <>
      <DirectionsService
        options={{
          origin,
          destination,
          travelMode: google.maps.TravelMode.WALKING,
        }}
        callback={directionsCallback}
      />

      {directions && (
        <DirectionsRenderer
          directions={directions}
          options={{
            suppressMarkers: false,
            polylineOptions: {
              strokeColor: '#4285F4',
              strokeWeight: 5,
            },
          }}
        />
      )}
    </>
  );
};
```

#### Day 19: æ‰€è¦æ™‚é–“è¡¨ç¤º

**ã‚¿ã‚¹ã‚¯ 8.3.4: RouteInfo.tsxã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**

```typescript
export const RouteInfo: React.FC<{ directions: google.maps.DirectionsResult }> = ({
  directions,
}) => {
  const route = directions.routes[0];
  const leg = route.legs[0];

  return (
    <Paper sx={{ p: 2, mb: 2 }}>
      <Typography variant="h6" gutterBottom>
        ãƒ«ãƒ¼ãƒˆæƒ…å ±
      </Typography>
      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
        <DirectionsWalkIcon />
        <Typography>å¾’æ­© {leg.duration?.text}</Typography>
      </Box>
      <Typography variant="body2" color="text.secondary">
        è·é›¢: {leg.distance?.text}
      </Typography>
      <Button variant="contained" sx={{ mt: 2 }} fullWidth>
        ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
      </Button>
    </Paper>
  );
};
```

---

### Phase 8.4: ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒãƒƒã‚°ï¼ˆ2æ—¥é–“ï¼‰

#### Day 20: E2Eãƒ†ã‚¹ãƒˆä½œæˆ

**ã‚¿ã‚¹ã‚¯ 8.4.1: Phase 8ã®E2Eãƒ†ã‚¹ãƒˆï¼ˆ8ä»¶ï¼‰**

`map.spec.ts`:
```typescript
test('ãƒãƒƒãƒ—ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
  await page.goto('/map');
  await expect(page.locator('.google-map')).toBeVisible();
});

test('ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ãƒãƒ¼ã‚«ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
  await page.goto('/map');
  await page.waitForSelector('img[src*="restaurant-marker"]');
  const markers = await page.locator('img[src*="restaurant-marker"]').count();
  expect(markers).toBeGreaterThan(0);
});

test('ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒªãƒƒã‚¯ã§æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
  await page.goto('/map');
  await page.click('img[src*="restaurant-marker"]').first();
  await expect(page.locator('.info-window')).toBeVisible();
});

test('ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‘ãƒãƒ«ãŒå‹•ä½œã™ã‚‹', async ({ page }) => {
  await page.goto('/map');
  await page.selectOption('select[name="park"]', 'disneyland');
  // ãƒãƒ¼ã‚«ãƒ¼æ•°ãŒå¤‰ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
});

test('ç¾åœ¨åœ°ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page, context }) => {
  await context.grantPermissions(['geolocation']);
  await page.goto('/map');
  await expect(page.locator('img[src*="current-location"]')).toBeVisible();
});

test('ãƒ«ãƒ¼ãƒˆæ¡ˆå†…ãƒœã‚¿ãƒ³ãŒå‹•ä½œã™ã‚‹', async ({ page }) => {
  await page.goto('/map');
  await page.click('img[src*="restaurant-marker"]').first();
  await page.click('text=ãƒ«ãƒ¼ãƒˆæ¡ˆå†…');
  await expect(page.locator('text=ãƒ«ãƒ¼ãƒˆæƒ…å ±')).toBeVisible();
});
```

#### Day 21: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã¨æœ€çµ‚èª¿æ•´

**ã‚¿ã‚¹ã‚¯ 8.4.2: ãƒãƒƒãƒ—èª­ã¿è¾¼ã¿æœ€é©åŒ–**

```typescript
// é…å»¶èª­ã¿è¾¼ã¿
const MapPage = lazy(() => import('./pages/MapPage'));

// ãƒãƒƒãƒ—ã®ãƒ¡ãƒ¢åŒ–
const MemoizedMap = memo(MapContainer);

// ãƒãƒ¼ã‚«ãƒ¼ã®æœ€é©åŒ–
const optimizedMarkers = useMemo(
  () => restaurants.map(r => ({ ...r, location: r.location })),
  [restaurants]
);
```

**ã‚¿ã‚¹ã‚¯ 8.4.3: APIä½¿ç”¨é‡ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°**

Google Cloud Consoleã§ç¢ºèª:
- Maps JavaScript API: 1æ—¥ã‚ãŸã‚Š100å›æœªæº€ã‚’ç›®æ¨™
- Geocoding API: 1å›ã®ã¿ï¼ˆåˆå›ãƒ‡ãƒ¼ã‚¿ä½œæˆæ™‚ï¼‰

**ã‚¿ã‚¹ã‚¯ 8.4.4: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ã¨æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤**

```bash
git add .
git commit -m "feat: Phase 8å®Ÿè£…å®Œäº† - ãƒãƒƒãƒ—æ©Ÿèƒ½"
git push origin main
vercel --prod
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¨ˆç”»

### E2Eãƒ†ã‚¹ãƒˆè¿½åŠ ï¼ˆ8ä»¶ï¼‰

1. ãƒãƒƒãƒ—ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
2. ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ãƒãƒ¼ã‚«ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
3. ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒªãƒƒã‚¯ã§æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹
4. ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‘ãƒãƒ«ãŒå‹•ä½œã™ã‚‹
5. ã‚¨ãƒªã‚¢åˆ¥çµã‚Šè¾¼ã¿ãŒå‹•ä½œã™ã‚‹
6. ç¾åœ¨åœ°ãŒè¡¨ç¤ºã•ã‚Œã‚‹
7. ãƒ«ãƒ¼ãƒˆæ¡ˆå†…ãŒè¡¨ç¤ºã•ã‚Œã‚‹
8. æ‰€è¦æ™‚é–“ãŒè¡¨ç¤ºã•ã‚Œã‚‹

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

- åˆå›ãƒãƒƒãƒ—èª­ã¿è¾¼ã¿: 2ç§’ä»¥å†…
- ãƒãƒ¼ã‚«ãƒ¼100å€‹è¡¨ç¤º: 1ç§’ä»¥å†…
- Google Maps APIä½¿ç”¨é‡: 3,000å›/æœˆä»¥å†…

---

## ğŸ“Š æˆæœæŒ‡æ¨™

### å®šé‡æŒ‡æ¨™

| æŒ‡æ¨™ | ç›®æ¨™ |
|------|------|
| ãƒãƒƒãƒ—ãƒšãƒ¼ã‚¸è¨ªå•ç‡ | 25%ä»¥ä¸Š |
| ãƒ«ãƒ¼ãƒˆæ¡ˆå†…ä½¿ç”¨æ•° | 100å›/æœˆ |
| ãƒãƒƒãƒ—æ“ä½œæ™‚é–“ | 3åˆ†ä»¥ä¸Š |
| E2Eãƒ†ã‚¹ãƒˆç·æ•° | 42ä»¶ |

---

## ğŸš€ æ¬¡ã®Phase

### Phase 9äºˆå‘Š: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“å‘ä¸Šï¼ˆ2é€±é–“ï¼‰

- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
- å¤šè¨€èªå¯¾å¿œï¼ˆè‹±èªï¼‰
- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¼·åŒ–

---

## ğŸ“š å‚è€ƒè³‡æ–™

- [Google Maps JavaScript API](https://developers.google.com/maps/documentation/javascript)
- [@react-google-maps/api](https://react-google-maps-api-docs.netlify.app/)
- [MarkerClusterer](https://github.com/googlemaps/js-markerclusterer)
- [æ±äº¬ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ãƒªã‚¾ãƒ¼ãƒˆå…¬å¼ãƒãƒƒãƒ—](https://www.tokyodisneyresort.jp/tdl/map.html)
